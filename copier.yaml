_envops:
  trim_blocks: true
  lstrip_blocks: true

project_type:
  type: str
  help: What type of project are you creating?
  choices:
    - "api-monolith"
    - "api-microservice"
    - "mcp-server"
    - "agent"

project_name:
  type: str
  help: What is your project name?
  validator: |
    {% if project_name | length < 1 %}
    project_name must cannot be empty string
    {% endif %}
    {% if not (project_name | regex_search('^[a-zA-Z][a-z0-9\-]+$')) %}
    project_name must start with a letter, followed one or more letters, digits or dashes (all lowercase).
    {% endif %}

project_description:
  type: str
  help: What is your project description (it will be used in pyproject.toml)?
  default: ""

python_versions:
  type: str
  help: What Python versions will be supported?
  default:
    - "3.13"
  multiselect: true
  choices:
    - "3.12"
    - "3.13"
    - "3.14"
  validator: |
    {% set all_ver = ["3.12", "3.13", "3.14"] %}
    {% if all_ver.index(python_versions[-1]) - all_ver.index(python_versions[0]) + 1 != python_versions|length %}
    python_versions must be a consecutive list of versions
    {% endif %}

default_python_version:
  type: str
  help: What is the default Python version?
  default: "{{python_versions[-1]}}"
  choices: |
    {% for ver in python_versions %}
    - "{{ver}}"
    {% endfor %}

_exclude:
  - /.github
  - /docs
  - /LICENSE
  - /README.md
  - copier.yaml
  - .git

  - "{{ '*/app/database.py' if project_type not in ['api-monolith', 'api-microservice', 'agent'] else '' }}"
  - "{{ '*/app/mappings.py' if project_type not in ['api-monolith', 'api-microservice', 'agent'] else '' }}"
  - "{{ '*/app/utils/mappings_meta.py' if project_type not in ['api-monolith', 'api-microservice', 'agent'] else '' }}"

  - "{{ '*/README_api.md' if project_type not in ['api-monolith', 'api-microservice'] else '' }}"
  - "{{ 'migrations' if project_type not in ['api-monolith', 'api-microservice'] else '' }}"
  - "{{ 'Dockerfile' if project_type not in ['api-monolith', 'api-microservice'] else '' }}"
  - "{{ 'docker-compose.yml' if project_type not in ['api-monolith', 'api-microservice'] else '' }}"

  - "{{ '*/app/api.py' if project_type != 'api-monolith' else '' }}"
  - "{{ '*/app/user' if project_type != 'api-monolith' else '' }}"
  - "{{ '*/app/repositories.py' if project_type != 'api-monolith' else '' }}"
  - "{{ '*/app/services.py' if project_type != 'api-monolith' else '' }}"

  - "{{ '*/app/models' if project_type != 'api-microservice' else '' }}"
  - "{{ '*/app/schemas/user.py' if project_type != 'api-microservice' else '' }}"
  - "{{ '*/app/services' if project_type != 'api-microservice' else '' }}"
  - "{{ '*/app/repositories' if project_type != 'api-microservice' else '' }}"
  - "{{ '*/app/api/routes/v1/user.py' if project_type != 'api-microservice' else '' }}"

  - "{{ '*/app/api' if project_type not in ['api-microservice', 'agent'] else '' }}"
  - "{{ '*/app/schemas' if project_type not in ['api-microservice', 'agent'] else '' }}"

  - "{{ '*/examples' if project_type != 'agent' else '' }}"
  - "{{ '*/README_agent.md' if project_type != 'agent' else '' }}"
  - "{{ '*/app/agent' if project_type != 'agent' else '' }}"
  - "{{ '*/app/gui.py' if project_type != 'agent' else '' }}"
  - "{{ '*/app/utils/date_handlers.py' if project_type != 'agent' else '' }}"
  - "{{ '*/app/utils/llm_vendor.py' if project_type != 'agent' else '' }}"

  - "{{ '*/README_mcp-server.md' if project_type != 'mcp-server' else '' }}"
  - "{{ '*/app/mcp' if project_type != 'mcp-server' else '' }}"

_tasks:
  - command: uvx python -c "import shutil; shutil.move('{{project_name}}/README_{{project_type}}.md', '{{project_name}}/README.md')"
    when: "{{ project_type in ['agent', 'mcp-server'] }}"
  - command: uvx python -c "import shutil; shutil.move('{{project_name}}/README_api.md', '{{project_name}}/README.md')"
    when: "{{ project_type in ['api-monolith', 'api-microservice'] }}"
  - command: uvx python -c "import os; os.makedirs('{{project_name}}/migrations/versions', exist_ok=True)"
    when: "{{ project_type in ['api-monolith', 'api-microservice'] }}"
  - "cd {{project_name}} && uv sync"
